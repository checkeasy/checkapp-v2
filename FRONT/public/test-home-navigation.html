<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  Test Navigation Home Button</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        
        .button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .results {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status-success { color: #059669; }
        .status-error { color: #dc2626; }
        .status-warning { color: #d97706; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  Test Navigation Home Button</h1>
            <p>Outil pour tester et dÃ©boguer la navigation du bouton Home</p>
        </div>
        
        <div class="content">
            <!-- Test Current State -->
            <div class="test-section">
                <h2>ğŸ“Š Ã‰tat Actuel</h2>
                <p>VÃ©rifiez l'Ã©tat actuel de navigation et les paramÃ¨tres URL.</p>
                <button class="button" onclick="checkCurrentState()">ğŸ” VÃ©rifier Ã‰tat Actuel</button>
                <div class="results" id="currentStateResults" style="display: none;"></div>
            </div>
            
            <!-- Simulate Navigation -->
            <div class="test-section">
                <h2>ğŸ§ª Simuler Navigation Home</h2>
                <p>Simulez le comportement du bouton Home selon la page actuelle.</p>
                <button class="button" onclick="simulateCheckinHome()">ğŸ  Simuler CheckIn â†’ Home</button>
                <button class="button" onclick="simulateCheckoutHome()">ğŸ  Simuler CheckOut â†’ Home</button>
                <div class="results" id="simulationResults" style="display: none;"></div>
            </div>
            
            <!-- Test Real Navigation -->
            <div class="test-section">
                <h2>ğŸš€ Navigation RÃ©elle</h2>
                <p>Testez la navigation rÃ©elle vers les pages CheckIn et CheckOut.</p>
                <button class="button" onclick="navigateToCheckin()">â¡ï¸ Aller Ã  CheckIn</button>
                <button class="button" onclick="navigateToCheckout()">â¡ï¸ Aller Ã  CheckOut</button>
                <button class="button" onclick="navigateToCheckinHome()">ğŸ  Aller Ã  CheckIn Home</button>
                <button class="button" onclick="navigateToCheckoutHome()">ğŸ  Aller Ã  CheckOut Home</button>
                <div class="results" id="navigationResults" style="display: none;"></div>
            </div>
            
            <!-- Debug Info -->
            <div class="test-section">
                <h2>ğŸ”§ Debug Info</h2>
                <p>Informations de dÃ©bogage pour comprendre le problÃ¨me.</p>
                <button class="button" onclick="showDebugInfo()">ğŸ” Afficher Debug Info</button>
                <button class="button" onclick="clearLocalStorage()">ğŸ—‘ï¸ Nettoyer localStorage</button>
                <div class="results" id="debugResults" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour vÃ©rifier l'Ã©tat actuel
        function checkCurrentState() {
            const container = document.getElementById('currentStateResults');
            container.style.display = 'block';
            
            const urlParams = new URLSearchParams(window.location.search);
            const currentPath = window.location.pathname;
            const parcours = urlParams.get('parcours');
            const checkid = urlParams.get('checkid');
            const activeCheckId = localStorage.getItem('activeCheckId');
            const lastPath = localStorage.getItem('checkeasy_last_path');
            
            let result = 'ğŸ“Š Ã‰TAT ACTUEL DE NAVIGATION\n';
            result += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            result += `ğŸŒ URL Actuelle: ${window.location.href}\n`;
            result += `ğŸ“ Chemin: ${currentPath}\n`;
            result += `ğŸ”— Parcours: ${parcours || 'NON DÃ‰FINI'}\n`;
            result += `ğŸ†” CheckId URL: ${checkid || 'NON DÃ‰FINI'}\n`;
            result += `ğŸ’¾ CheckId localStorage: ${activeCheckId || 'NON DÃ‰FINI'}\n`;
            result += `ğŸ“‚ Dernier chemin: ${lastPath || 'NON DÃ‰FINI'}\n\n`;
            
            // DÃ©terminer le flow attendu
            let expectedFlow = 'INDÃ‰TERMINÃ‰';
            let expectedHome = 'INDÃ‰TERMINÃ‰';
            
            if (currentPath.includes('/checkin')) {
                expectedFlow = 'CHECKIN';
                expectedHome = '/checkin-home';
            } else if (currentPath.includes('/checkout')) {
                expectedFlow = 'CHECKOUT';
                expectedHome = '/checkout-home';
            }
            
            result += `ğŸ¯ Flow Attendu: ${expectedFlow}\n`;
            result += `ğŸ  Home Attendu: ${expectedHome}\n\n`;
            
            // VÃ©rifier la cohÃ©rence
            const isConsistent = checkid === activeCheckId;
            result += `âœ… CohÃ©rence CheckId: ${isConsistent ? 'OUI' : 'NON'}\n`;
            
            if (!isConsistent) {
                result += `âš ï¸ PROBLÃˆME: CheckId URL (${checkid}) â‰  localStorage (${activeCheckId})\n`;
            }
            
            container.textContent = result;
        }
        
        // Simuler navigation CheckIn Home
        function simulateCheckinHome() {
            const container = document.getElementById('simulationResults');
            container.style.display = 'block';
            
            let result = 'ğŸ§ª SIMULATION: CheckIn â†’ Home\n';
            result += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            
            // Simuler la logique handleGoBack de CheckIn
            const currentPath = '/checkin';
            const expectedTarget = '/checkin-home';
            
            result += `ğŸ“ Page Actuelle: ${currentPath}\n`;
            result += `ğŸ¯ Cible Attendue: ${expectedTarget}\n`;
            result += `ğŸ”„ Action: handleGoBack() dans CheckIn.tsx\n\n`;
            
            // VÃ©rifier les paramÃ¨tres
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours');
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId');
            
            if (parcours && checkid) {
                const simulatedUrl = `${expectedTarget}?parcours=${parcours}&checkid=${checkid}`;
                result += `âœ… URL SimulÃ©e: ${simulatedUrl}\n`;
                result += `âœ… ParamÃ¨tres PrÃ©servÃ©s: OUI\n`;
            } else {
                result += `âŒ ParamÃ¨tres Manquants:\n`;
                result += `   - Parcours: ${parcours || 'MANQUANT'}\n`;
                result += `   - CheckId: ${checkid || 'MANQUANT'}\n`;
            }
            
            container.textContent = result;
        }
        
        // Simuler navigation CheckOut Home
        function simulateCheckoutHome() {
            const container = document.getElementById('simulationResults');
            container.style.display = 'block';
            
            let result = 'ğŸ§ª SIMULATION: CheckOut â†’ Home\n';
            result += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            
            // Simuler la logique handleGoBack de CheckOut
            const currentPath = '/checkout';
            const expectedTarget = '/checkout-home';
            
            result += `ğŸ“ Page Actuelle: ${currentPath}\n`;
            result += `ğŸ¯ Cible Attendue: ${expectedTarget}\n`;
            result += `ğŸ”„ Action: handleGoBack() dans CheckOut.tsx\n\n`;
            
            // VÃ©rifier les paramÃ¨tres
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours');
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId');
            
            if (parcours && checkid) {
                const simulatedUrl = `${expectedTarget}?parcours=${parcours}&checkid=${checkid}`;
                result += `âœ… URL SimulÃ©e: ${simulatedUrl}\n`;
                result += `âœ… ParamÃ¨tres PrÃ©servÃ©s: OUI\n`;
            } else {
                result += `âŒ ParamÃ¨tres Manquants:\n`;
                result += `   - Parcours: ${parcours || 'MANQUANT'}\n`;
                result += `   - CheckId: ${checkid || 'MANQUANT'}\n`;
            }
            
            container.textContent = result;
        }
        
        // Navigation rÃ©elle vers CheckIn
        function navigateToCheckin() {
            const container = document.getElementById('navigationResults');
            container.style.display = 'block';
            
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours') || 'test-parcours';
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId') || 'test-checkid';
            
            const targetUrl = `/checkin?parcours=${parcours}&checkid=${checkid}`;
            
            container.textContent = `ğŸš€ Navigation vers: ${targetUrl}\n\nRedirection dans 2 secondes...`;
            
            setTimeout(() => {
                window.location.href = targetUrl;
            }, 2000);
        }
        
        // Navigation rÃ©elle vers CheckOut
        function navigateToCheckout() {
            const container = document.getElementById('navigationResults');
            container.style.display = 'block';
            
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours') || 'test-parcours';
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId') || 'test-checkid';
            
            const targetUrl = `/checkout?parcours=${parcours}&checkid=${checkid}`;
            
            container.textContent = `ğŸš€ Navigation vers: ${targetUrl}\n\nRedirection dans 2 secondes...`;
            
            setTimeout(() => {
                window.location.href = targetUrl;
            }, 2000);
        }
        
        // Navigation vers CheckIn Home
        function navigateToCheckinHome() {
            const container = document.getElementById('navigationResults');
            container.style.display = 'block';
            
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours') || 'test-parcours';
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId') || 'test-checkid';
            
            const targetUrl = `/checkin-home?parcours=${parcours}&checkid=${checkid}`;
            
            container.textContent = `ğŸš€ Navigation vers: ${targetUrl}\n\nRedirection dans 2 secondes...`;
            
            setTimeout(() => {
                window.location.href = targetUrl;
            }, 2000);
        }
        
        // Navigation vers CheckOut Home
        function navigateToCheckoutHome() {
            const container = document.getElementById('navigationResults');
            container.style.display = 'block';
            
            const urlParams = new URLSearchParams(window.location.search);
            const parcours = urlParams.get('parcours') || 'test-parcours';
            const checkid = urlParams.get('checkid') || localStorage.getItem('activeCheckId') || 'test-checkid';
            
            const targetUrl = `/checkout-home?parcours=${parcours}&checkid=${checkid}`;
            
            container.textContent = `ğŸš€ Navigation vers: ${targetUrl}\n\nRedirection dans 2 secondes...`;
            
            setTimeout(() => {
                window.location.href = targetUrl;
            }, 2000);
        }
        
        // Afficher debug info
        function showDebugInfo() {
            const container = document.getElementById('debugResults');
            container.style.display = 'block';
            
            let result = 'ğŸ”§ INFORMATIONS DE DEBUG\n';
            result += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            
            // localStorage complet
            result += 'ğŸ’¾ localStorage:\n';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('checkeasy') || key === 'activeCheckId') {
                    const value = localStorage.getItem(key);
                    result += `   ${key}: ${value ? value.substring(0, 100) + (value.length > 100 ? '...' : '') : 'null'}\n`;
                }
            }
            
            result += '\nğŸŒ URL Info:\n';
            result += `   href: ${window.location.href}\n`;
            result += `   pathname: ${window.location.pathname}\n`;
            result += `   search: ${window.location.search}\n`;
            result += `   hash: ${window.location.hash}\n`;
            
            result += '\nğŸ• Timestamp: ' + new Date().toISOString();
            
            container.textContent = result;
        }
        
        // Nettoyer localStorage
        function clearLocalStorage() {
            const container = document.getElementById('debugResults');
            container.style.display = 'block';
            
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('checkeasy') || key === 'activeCheckId')) {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            container.textContent = `ğŸ—‘ï¸ localStorage nettoyÃ©!\n\nClÃ©s supprimÃ©es:\n${keysToRemove.join('\n')}`;
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            checkCurrentState();
        });
    </script>
</body>
</html>
